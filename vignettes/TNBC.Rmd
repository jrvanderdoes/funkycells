---
title: "TNBC"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TNBC}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
  knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>"
)
```

```{r setup}
  library(funkycells)
```

This vignette documents a sample analysis of Triple Negative Breast Cancer (TNBC) data, retrieved from \url{https://www.angelolab.com/mibi-data}. The data has been preloaded into this package. The following two data sets are retrieved.
```{r getData}
  TNBC <- TNBC
  TNBC_Meta <- TNBC_Meta
```

We recommend exploring this data, and additional information is available in the data documentation. Such analysis reveals TNBC contains the cell information while TNBC_Meta contains the metadata. 

The first step is to convert the cell data into K functions. This data is unique since rather than giving a cell type, a T/F column is given for different columns. Therefore, the K functions, discritized using PCA is computed as follows.
```{r computePCA}
  agents_df <- expand.grid(c("FoxP3","Lag3","CD4","CD16","CD56","PD1","PD.L1","Ki67","CD138","CD68","CD8","CD3","IDO","CD45RO","CD20","p53","MPO","tumorYN"),c("FoxP3","Lag3","CD4","CD16","CD56","PD1","PD.L1","Ki67","CD138","CD68","CD8","CD3","IDO","CD45RO","CD20","p53","MPO","tumorYN"))
  dataPCA <- getPCAData(data = TNBC[,-3], unit='Person', agents_df=agents_df, rCheckVals = seq(0,50,1))
```

The resulting data is merged with the meta data for use in analysis.
```{r addMeta}
  dataPCAAge  <- merge(dataPCA,TNBC_Meta)
```

We then compute the cross-validated random forest.
```{r computeRFCV}
  rfcv <- computeRandomForest_CVPC(data=dataPCAAge, K=10, outcome='Class',unit='Person',repeatedId=NULL, metaNames=c('Age'),cellData= TNBC[,-3], syntheticKs=100, syntheticMetas=100, generalSyntheticK=T,alpha=0.05,curvedSigSims = 100, silent=F,subsetPlotSize = 25, nTrees=1000)
```

And finally the resulting plots-both full and subsetted--can be examined.
```{r viewFullPlot, fig.width=10, fig.height=11, fig.cap="All Variables"}
  rfcv$multIntVI$viPlot
```

```{r viewSubPlot, fig.width=10, fig.height=11, fig.cap="Top 25 Variables"}
  rfcv$multIntVI$subset_viPlot
```
